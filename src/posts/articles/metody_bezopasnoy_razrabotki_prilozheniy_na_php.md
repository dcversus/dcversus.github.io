---
template: post
title: Методы безопасной разработки приложений на php
date: 2015-03-09
tags:
    - article
---

PHP - скриптовый язык общего назначения, применяемый в основном для разработки веб-приложений. При разработке, неопытные разработчики часто не придают должного внимания вопросам безопасности, из-за чего даже в простых скриптах возникают уязвимости.

Статья посвящена некоторым базовым практикам обеспечения безопасности веб-приложений при их разработки.

Одним из типов угроз веб-приложений является XSS - Cross Site Scripting. Её суть заключается в внедрении в атакуемый сайт кода, который собирал бы выполнял произвольный код на сайте жертвы, например собирал бы данные о посетителях (cookies, localstorage, localdb). Существует два типа XSS уязвимостей - пассивная и активная. Активная уязвимость заключается в интеграции в атакуемый сайт вредоносного кода, например через с помощью SQL-кода (SQL Injection). Примером пассивной уязвимости может послужить отправка жертве письма, в котором якобы администрация сервиса просит проверить настройки аккаунта, где ссылка содержит адрес сайта злоумышленника или вредоносный код.

Кража Cookies является одной из целей XSS. В Cookies часто хранят ценную информацию, например логин или хеш пароля, но самой опасной считается кража активной сессии (поэтому не забываем нажимать выход на ссайтах, даже если это домашний компьютер). При разработки приложения делайте время жизни сессии ограниченным и не храните важные данные в cookies.

Кража данных из форм. Вредоносный код, размещенный на формах ввода данных может собирать и отправлять злоумышленнику введенные данные. Поэтому на страницах, где обеспечивается вывод введенных данных (это например может быть гостевая книга или форум) не устанавливайте формы авторизации, для этого нужны отдельные страницы.

DDoS-атака. Целью XSS может являться размещение активного элемента на очень посещаемом ресурсе с ссылкой на ресурс не рассчитанный на такую нагрузку, что приводит к выводу из строя последнего. Для защиты своего сайта от такой атаки необходимо вести логирование посещений и отслеживание их рефера и в случае достижения лимитов, блокировать посещение с определенных реферов (по методу черного списка).

Подделка межсайтовых запросов (CSRF). Суть заключается в том, что пользователь авторизованный на атакуемом сайте заходит на сайт в котором используется уязвимость (или сайте злоумышленника) с помощью которой отправляется запрос на совершение определенных действий на атакуемом сайте. Для обеспечение безопасности, всегда при проведении важных операций (таких как списание и перевод денежных средств или смена пароля) требуйте подтверждения через сторонние сервисы (подтверждение по email или смс).

XSS-черви. Тип атаки распространенный в социальных сетях, при которым пользователю отправляется ссылка, перейдя по которой исполняется интегрированный скрипт отправляющий другим пользователям от имени жертвы такую ссылку. Защититься можно запретив прямые внешние ссылки и проводя пользователя при покидании сайта через специальную страницу, которая бы предупреждала пользователя о возможной угрозе.

Для обеспечения безопасности вашего приложения, от вышеупомянутых угроз, могут послужить специальные функции php:

addslashes - добавляет слеши перед ковычками и превращает их в escape последовательности . $_POST['name'] = addslashes($_POST['name']);

strip_tags - убирает все теги html и php сущности из строки. $_POST['name'] = strip_tags ($_POST['name']);

htmlspecialchars - заменяет специальные символы в html сущности

- & (амперсанд) преобразуется в '&amp;'
- " (двойная кавычка) преобразуется в '&quot;'
- ' (одиночная кавычка) преобразуется в '&#039;' (или &apos;) только в режиме ENT_QUOTES.
- < (знак "меньше чем") преобразуется в '&lt;'
- > (знак "больше чем") преобразуется в '&gt;'

$_POST['name'] = htmlspecialchars ($_POST['name']);

preg_replace - функция которая по регулярному вырожению делает замены в строке. Регулярное выражение /[^a-z0-9]/i заменит все, что не относится к допустимым символам. $_POST['name'] = preg_replace("/[^a-z0-9]/i", "", $_POST['name']);

mysql_real_escape_string - экранирует специальные символы, чтобы их можно было использовать вSQL запросе. Данную функцию можно использовать, только после подключения к базе данных. $_POST['name'] = mysql_real_escape_string ($_POST['name']);

В дополнение к этому можно обезопасить себя, скрыв использование php, что является превентивной мерой при малых затратах. При использовании сервера apache в конфигурационном файле php.ini установите директиву expose_php в off и вы уменьшите количество доступной хакеру информации до минимума. При использовании .htaccess файлов, вы можете "замаскировать" исполняемые файлы под другой язык программирования, например с помощью директивы AddType application/x-httpd-php .asp .py Вы можете размещать исполняемый код php в файлах с расширением asp. А с использованием директивы AddType application/x-httpd-php .htm .html можно размещать исполняемый код в обычных html файлах!

Также обязательно, в директориях где нет исполняемых файлов и куда вы ведете загрузку пользовательских файлов добавляйте файл .htaccess со следующим содержимым:

Header set Content-Disposition attachment

php_flag engine 0

AddType "text/html" .php .cgi .pl .fcgi .fpl .phtml .shtml .php2 .php3 .php4 .php5 .asp .jsp

Это запретит исполнение любого кода в директориях (с данным файлом).
